<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å‡ºæ ˆåºåˆ—ç”ŸæˆåŠ¨ç”» - å›æº¯ç®—æ³•å¯è§†åŒ–</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #ff9a9e 0%, #fad0c4 100%);
            color: #333;
            padding: 20px;
            margin: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
        }

        .container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 25px;
            max-width: 900px;
            width: 100%;
        }

        .visualization-area {
            display: flex;
            justify-content: space-around;
            width: 100%;
            flex-wrap: wrap;
            gap: 30px;
        }

        .section {
            background: white;
            border-radius: 16px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
            text-align: center;
            min-width: 200px;
            flex: 1;
        }

        .section h3 {
            margin-top: 0;
            color: #e74c3c;
            font-size: 18px;
        }

        /* è¾“å…¥é˜Ÿåˆ—ï¼šæ°´å¹³ */
        .input-queue {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 15px;
        }

        .input-item {
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #ffeaa7;
            border: 2px solid #fdcb6e;
            border-radius: 10px;
            font-weight: bold;
            font-size: 20px;
            transition: all 0.3s ease;
        }

        .input-item.highlight {
            transform: scale(1.1);
            box-shadow: 0 0 15px #fdcb6e;
        }

        /* æ ˆï¼šå‚ç›´ï¼Œé¡¶éƒ¨åœ¨ä¸Š */
        .stack {
            display: flex;
            flex-direction: column-reverse;
            align-items: center;
            gap: 8px;
            margin-top: 15px;
            min-height: 150px;
            justify-content: flex-end;
        }

        .stack-item {
            width: 60px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #74b9ff;
            border: 2px solid #0984e3;
            border-radius: 8px;
            font-weight: bold;
            font-size: 18px;
            transition: all 0.3s ease;
        }

        .stack-item.top {
            background: #00b894;
            border-color: #00a085;
            transform: scale(1.05);
            box-shadow: 0 0 12px rgba(0,184,148,0.5);
        }

        /* è¾“å‡ºåºåˆ—ï¼šæ°´å¹³ */
        .output-sequence {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 15px;
            min-height: 60px;
        }

        .output-item {
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #55efc4;
            border: 2px solid #00b894;
            border-radius: 10px;
            font-weight: bold;
            font-size: 20px;
            transition: all 0.3s ease;
        }

        .output-item.new {
            animation: popIn 0.6s ease;
        }

        @keyframes popIn {
            0% { transform: scale(0.5); opacity: 0; }
            70% { transform: scale(1.1); }
            100% { transform: scale(1); opacity: 1; }
        }

        /* æ§åˆ¶é¢æ¿ */
        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            justify-content: center;
            padding: 20px;
            background: white;
            border-radius: 16px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
            width: 100%;
        }

        button {
            background: #6c5ce7;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            min-width: 100px;
        }

        button:hover:not(:disabled) {
            background: #a29bfe;
            transform: translateY(-2px);
        }

        button:disabled {
            background: #bdc3c7;
            cursor: not-allowed;
            transform: none;
        }

        .speed-control {
            display: flex;
            align-items: center;
            gap: 10px;
            background: #f7f7f7;
            padding: 10px 15px;
            border-radius: 20px;
        }

        .log-area {
            width: 100%;
            max-height: 180px;
            overflow-y: auto;
            background: white;
            padding: 15px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            font-family: monospace;
            font-size: 14px;
            line-height: 1.5;
        }

        .results-list {
            width: 100%;
            background: white;
            padding: 15px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            text-align: center;
        }

        .results-list h3 {
            color: #e74c3c;
            margin-top: 0;
        }

        .sequence-item {
            display: inline-block;
            margin: 5px;
            padding: 8px 15px;
            background: #ffeaa7;
            border-radius: 20px;
            font-weight: bold;
            border: 1px solid #fdcb6e;
        }

        h1 {
            text-align: center;
            color: #e74c3c;
            text-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 10px;
        }

        p {
            text-align: center;
            max-width: 700px;
            margin-bottom: 20px;
            color: #636e72;
        }
    </style>
</head>
<body>
    <h1>ğŸ“¦ å‡ºæ ˆåºåˆ—ç”ŸæˆåŠ¨ç”»</h1>
    <p>å¯è§†åŒ–å›æº¯ç®—æ³•ï¼šæ¢ç´¢æ‰€æœ‰ 1,2,3 çš„åˆæ³•å‡ºæ ˆé¡ºåºï¼ˆå…± 5 ç§ï¼‰</p>

    <div class="container">
        <div class="visualization-area">
            <div class="section">
                <h3>ğŸ“¥ è¾“å…¥é˜Ÿåˆ—</h3>
                <div class="input-queue" id="input-queue"></div>
            </div>

            <div class="section">
                <h3>ğŸ§± æ ˆ (Stack)</h3>
                <div class="stack" id="stack"></div>
            </div>

            <div class="section">
                <h3>ğŸ“¤ è¾“å‡ºåºåˆ—</h3>
                <div class="output-sequence" id="output-sequence"></div>
            </div>
        </div>

        <div class="controls">
            <button id="start-btn">â–¶ï¸ å¼€å§‹ç”Ÿæˆ</button>
            <button id="pause-btn" disabled>â¸ï¸ æš‚åœ</button>
            <button id="step-btn" disabled>â­ï¸ å•æ­¥</button>
            <button id="reset-btn">ğŸ”„ é‡ç½®</button>
            <div class="speed-control">
                <label>é€Ÿåº¦:</label>
                <input type="range" id="speed-slider" min="300" max="2000" value="1000" step="100">
                <span id="speed-value">1000ms</span>
            </div>
        </div>

        <div class="log-area" id="log-area">
            <!-- æ—¥å¿—å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
        </div>

        <div class="results-list">
            <h3>âœ… æ‰€æœ‰åˆæ³•å‡ºæ ˆåºåˆ—</h3>
            <div id="results-container"></div>
        </div>
    </div>

    <script>
        // åˆå§‹è¾“å…¥åºåˆ—
        const INITIAL_INPUT = [1, 2, 3];
        let currentInput = [];
        let currentStack = [];
        let currentOutput = [];
        let allResults = [];

        // DOM å…ƒç´ 
        const inputQueueEl = document.getElementById('input-queue');
        const stackEl = document.getElementById('stack');
        const outputSeqEl = document.getElementById('output-sequence');
        const logArea = document.getElementById('log-area');
        const resultsContainer = document.getElementById('results-container');
        const startBtn = document.getElementById('start-btn');
        const pauseBtn = document.getElementById('pause-btn');
        const stepBtn = document.getElementById('step-btn');
        const resetBtn = document.getElementById('reset-btn');
        const speedSlider = document.getElementById('speed-slider');
        const speedValue = document.getElementById('speed-value');

        // çŠ¶æ€æ§åˆ¶
        let isRunning = false;
        let isPaused = false;
        let isStepMode = false;
        let animationQueue = [];
        let animationTimeout = null;

        // æ“ä½œç±»å‹
        const ACTION = {
            PUSH: 'push',
            POP: 'pop',
            UNDO_PUSH: 'undo_push',
            UNDO_POP: 'undo_pop',
            ADD_RESULT: 'add_result',
            FINISH: 'finish'
        };

        // åˆå§‹åŒ–æ˜¾ç¤º
        function renderState() {
            // æ¸²æŸ“è¾“å…¥é˜Ÿåˆ—
            inputQueueEl.innerHTML = '';
            currentInput.forEach((num, idx) => {
                const el = document.createElement('div');
                el.className = 'input-item';
                el.textContent = num;
                if (idx === 0) el.classList.add('highlight'); // é˜Ÿé¦–é«˜äº®
                inputQueueEl.appendChild(el);
            });

            // æ¸²æŸ“æ ˆï¼ˆé¡¶éƒ¨åœ¨ä¸Šï¼‰
            stackEl.innerHTML = '';
            currentStack.forEach((num, idx) => {
                const el = document.createElement('div');
                el.className = 'stack-item';
                el.textContent = num;
                if (idx === currentStack.length - 1) el.classList.add('top'); // æ ˆé¡¶é«˜äº®
                stackEl.appendChild(el);
            });

            // æ¸²æŸ“è¾“å‡ºåºåˆ—
            outputSeqEl.innerHTML = '';
            currentOutput.forEach(num => {
                const el = document.createElement('div');
                el.className = 'output-item';
                el.textContent = num;
                outputSeqEl.appendChild(el);
            });
        }

        // æ·»åŠ æ—¥å¿—
        function addLog(message) {
            const logEntry = document.createElement('div');
            logEntry.textContent = message;
            logEntry.style.padding = '4px 0';
            logArea.appendChild(logEntry);
            logArea.scrollTop = logArea.scrollHeight;
        }

        // æ·»åŠ ç»“æœåˆ°å±•ç¤ºåŒº
        function addResultToDisplay(sequence) {
            const seqStr = sequence.join(' ');
            const existing = Array.from(resultsContainer.querySelectorAll('.sequence-item'))
                .map(el => el.textContent);
            if (!existing.includes(seqStr)) {
                const item = document.createElement('div');
                item.className = 'sequence-item';
                item.textContent = seqStr;
                resultsContainer.appendChild(item);
            }
        }

        // å›æº¯ç®—æ³•ï¼šç”Ÿæˆæ‰€æœ‰å‡ºæ ˆåºåˆ—
        function generateSequences() {
            animationQueue = [];
            allResults = [];
            resultsContainer.innerHTML = '';
            logArea.innerHTML = '';
            addLog("å¼€å§‹ç”Ÿæˆæ‰€æœ‰åˆæ³•å‡ºæ ˆåºåˆ—...");

            function dfs(input, stack, output) {
                // ç»ˆæ­¢æ¡ä»¶ï¼šè¾“å…¥ä¸ºç©ºä¸”æ ˆä¸ºç©º
                if (input.length === 0 && stack.length === 0) {
                    const result = [...output];
                    allResults.push(result);
                    animationQueue.push({ type: ACTION.ADD_RESULT, sequence: result });
                    return;
                }

                // é€‰æ‹©1ï¼šå¦‚æœè¾“å…¥éç©ºï¼Œå¯ä»¥ Push
                if (input.length > 0) {
                    const next = input[0];
                    // Push æ“ä½œ
                    animationQueue.push({ 
                        type: ACTION.PUSH, 
                        value: next,
                        fromInput: [...input],
                        toStack: [...stack, next],
                        output: [...output]
                    });

                    dfs(
                        input.slice(1),
                        [...stack, next],
                        [...output]
                    );

                    // æ’¤é”€ Pushï¼ˆå›æº¯ï¼‰
                    animationQueue.push({ 
                        type: ACTION.UNDO_PUSH, 
                        value: next,
                        fromInput: [...input],
                        toStack: [...stack],
                        output: [...output]
                    });
                }

                // é€‰æ‹©2ï¼šå¦‚æœæ ˆéç©ºï¼Œå¯ä»¥ Pop
                if (stack.length > 0) {
                    const top = stack[stack.length - 1];
                    // Pop æ“ä½œ
                    animationQueue.push({ 
                        type: ACTION.POP, 
                        value: top,
                        fromInput: [...input],
                        stack: [...stack.slice(0, -1)],
                        toOutput: [...output, top]
                    });

                    dfs(
                        [...input],
                        stack.slice(0, -1),
                        [...output, top]
                    );

                    // æ’¤é”€ Popï¼ˆå›æº¯ï¼‰
                    animationQueue.push({ 
                        type: ACTION.UNDO_POP, 
                        value: top,
                        fromInput: [...input],
                        stack: [...stack],
                        toOutput: [...output]
                    });
                }
            }

            dfs([...INITIAL_INPUT], [], []);
            animationQueue.push({ type: ACTION.FINISH });
        }

        // æ‰§è¡Œå•ä¸ªåŠ¨ç”»æ­¥éª¤
        function executeAnimationStep(action) {
            switch (action.type) {
                case ACTION.PUSH:
                    currentInput = action.fromInput;
                    currentStack = action.toStack;
                    currentOutput = action.output;
                    addLog(`ğŸ“¥ Push ${action.value} å…¥æ ˆ`);
                    break;

                case ACTION.POP:
                    currentInput = action.fromInput;
                    currentStack = action.stack;
                    currentOutput = action.toOutput;
                    addLog(`ğŸ“¤ Pop ${action.value} å‡ºæ ˆ â†’ è¾“å‡º`);
                    // ä¸ºæ–°è¾“å‡ºé¡¹æ·»åŠ åŠ¨ç”»ç±»
                    setTimeout(() => {
                        const items = outputSeqEl.querySelectorAll('.output-item');
                        if (items.length > 0) {
                            items[items.length - 1].classList.add('new');
                        }
                    }, 50);
                    break;

                case ACTION.UNDO_PUSH:
                    currentInput = action.fromInput;
                    currentStack = action.toStack;
                    currentOutput = action.output;
                    addLog(`â†©ï¸ å›æº¯ï¼šæ’¤é”€ Push ${action.value}`);
                    break;

                case ACTION.UNDO_POP:
                    currentInput = action.fromInput;
                    currentStack = action.stack;
                    currentOutput = action.toOutput;
                    addLog(`â†©ï¸ å›æº¯ï¼šæ’¤é”€ Pop ${action.value}`);
                    break;

                case ACTION.ADD_RESULT:
                    addResultToDisplay(action.sequence);
                    addLog(`âœ… æ‰¾åˆ°åºåˆ—: ${action.sequence.join(' ')}`);
                    break;

                case ACTION.FINISH:
                    addLog(`âœ¨ å®Œæˆï¼å…±æ‰¾åˆ° ${allResults.length} ç§åˆæ³•åºåˆ—`);
                    break;
            }
            renderState();
        }

        // æ’­æ”¾ä¸‹ä¸€åŠ¨ç”»
        function playNextAnimation() {
            if (!isRunning || isPaused || animationQueue.length === 0) return;

            const action = animationQueue.shift();
            executeAnimationStep(action);

            if (action.type === ACTION.FINISH) {
                isRunning = false;
                updateButtons();
                return;
            }

            if (isStepMode) {
                isStepMode = false;
                isPaused = true;
                updateButtons();
            } else {
                const delay = parseInt(speedSlider.value);
                animationTimeout = setTimeout(playNextAnimation, delay);
            }
        }

        // æ›´æ–°æŒ‰é’®çŠ¶æ€
        function updateButtons() {
            startBtn.disabled = isRunning && !isPaused;
            pauseBtn.disabled = !isRunning;
            stepBtn.disabled = !isRunning;
            pauseBtn.textContent = isPaused ? 'â–¶ï¸ ç»§ç»­' : 'â¸ï¸ æš‚åœ';
        }

        // æ§åˆ¶å‡½æ•°
        function startGeneration() {
            if (isRunning) return;
            isRunning = true;
            isPaused = false;
            isStepMode = false;
            currentInput = [...INITIAL_INPUT];
            currentStack = [];
            currentOutput = [];
            renderState();
            generateSequences();
            playNextAnimation();
            updateButtons();
        }

        function togglePause() {
            if (!isRunning) return;
            isPaused = !isPaused;
            if (!isPaused) {
                playNextAnimation();
            }
            updateButtons();
        }

        function stepForward() {
            if (!isRunning) return;
            isPaused = true;
            isStepMode = true;
            playNextAnimation();
            updateButtons();
        }

        function resetAll() {
            if (animationTimeout) clearTimeout(animationTimeout);
            isRunning = false;
            isPaused = false;
            isStepMode = false;
            currentInput = [...INITIAL_INPUT];
            currentStack = [];
            currentOutput = [];
            allResults = [];
            resultsContainer.innerHTML = '';
            logArea.innerHTML = '';
            addLog("å·²é‡ç½®ï¼Œå‡†å¤‡ç”Ÿæˆå‡ºæ ˆåºåˆ—");
            renderState();
            updateButtons();
        }

        // äº‹ä»¶ç›‘å¬
        startBtn.addEventListener('click', startGeneration);
        pauseBtn.addEventListener('click', togglePause);
        stepBtn.addEventListener('click', stepForward);
        resetBtn.addEventListener('click', resetAll);
        speedSlider.addEventListener('input', () => {
            speedValue.textContent = `${speedSlider.value}ms`;
        });

        // åˆå§‹åŒ–
        resetAll();
    </script>
</body>
</html>
